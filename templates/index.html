{{template "DocumentStart" .}}

<div class="p-2">
    <div>
        <strong>Output format</strong>
    </div>
    <select id="output-select" class="py-2 border-2 border-black mb-3 px-5 bg-white">
        <option value="mobi">MOBI</option>
        <option value="azw3">AZW3</option>
        <option value="epub">EPUB</option>
        <option value="pdf">PDF</option>
    </select>
    <div class="my-dropzone dropzone mb-10">
    </div>
    <div class="border border-black"></div>
    <div class="mb-3 mt-10">
        <strong>Download List</strong>
    </div>
    <style>
        .trash {
            background-image: url('/static/trash-solid.svg');
            background-size: 80% 80%;
            background-position: center;
            background-repeat: no-repeat;
        }
    </style>
    {{range .Props.Entries}}

    <div class="py-2 border-2 border-black mb-3 px-5 bg-white flex ">
        <a href="/api/read/?path={{.}}&folder={{$.Props.Folder}}"  class="flex-1 underline">
           {{.}}  
        </a>
        <div onclick="deleteFile('{{.}}')" class="rounded-md border-2 border-black w-6 h-6 cursor-pointer trash">
        </div>
    </div>

    {{end}}
</div>

<script>
    var folder = "{{.Props.Folder}}"
    function loadDropZone() {
        let ele = document.querySelector("div.my-dropzone")
        ele.classList.add("dropzone")

        let dropzone = undefined;
        try {
            dropzone = new Dropzone("div.my-dropzone", {
                url: "/api/upload/",
                parallelUploads: 3,
                paramName: "file",
                maxFilesize: 1024 * 5,
            });
        } catch (ex) {
            location.reload()
        }

        if (dropzone != undefined) {
            dropzone.on("sending", function (file, xhr, formData) {
                // Will send the filesize along with the file as POST data.
                let output = document.getElementById("output-select");
                formData.append("output", output.value);
                formData.append("folder", folder);
                // formData.append("name", file.name)
            });
            dropzone.on("complete", function () {
                if (this.getUploadingFiles().length === 0 && this.getQueuedFiles().length === 0) {
                    let b64Str = " "
                    location.reload()
                }
            })
        }

    }
    loadDropZone();

    function deleteFile(path) {
        if (confirm("Are you sure to delete this file?")){
            fetch(`/api/delete/?path=${path}&folder=${folder}`).then((res)=>{ 
                location.reload()
            })
        }
    }
</script>
{{template "DocumentEnd" .}}